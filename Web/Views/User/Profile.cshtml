@{
    ViewData["Title"] = "Profile";
}

@model Entity.ViewModel.UserViewModel;

<h2 class="dt p-2">My Profile</h2>
<div class="form">
    <form asp-controller="User" asp-action="Profile" method="post">
        <div class="profile-bg">
            <img class="img-1" src="@Url.Content("~/assets/profile_div_bg.jpg")" alt="">
            <div class="user-container">
                <img class="img-2" src="@Url.Content("~/assets/Default_pfp.svg.png")" alt="">
                <div class="m-0 pt-2">
                    <h5 class="m-0">@Model.FirstName @Model.LastName</h5>
                    <p class="m-0">@Model.RoleName</p>
                </div>
            </div>
        </div>

        <br>
        <div class="col-xl-12" style="margin-top: 40px;">
            <div class="row">
                <div class="form-floating col">
                    <input type="text" class="form-control twoc" id="FirstName" asp-for="FirstName">
                    <label for="FirstName" class="float">First Name</label>
                </div>
                <div class="form-floating col">
                    <input type="text" class="form-control twoc" id="LastName" asp-for="LastName">
                    <label for="LastName" class="float">Last Name</label>
                </div>
            </div>
        </div>
        <br>
        <div class="col-xl-12">
            <div class="row">
                <div class="form-floating col">
                    <input type="text" class="form-control twoc" id="Username" asp-for="Username">
                    <label for="Username" class="float">User Name</label>
                </div>
                <div class="form-floating col">
                    <input type="text" class="form-control twoc" id="Phone" asp-for="Phone">
                    <label for="Phone" class="float">Phone</label>
                </div>
            </div>
        </div>

        <br>

        <div class="col-xl-12">
            <div class="row">
                <div class="form-floating col">
                    <select id="CountryId" name="CountryId" class="form-control" asp-items="ViewBag.Countries"></select>
                    <label for="CountryId" class="float">Country</label>
                </div>
                <div class="form-floating col">
                    <select id="StateId" name="StateId" class="form-control" asp-items="ViewBag.States"></select>
                    <label for="StateId" class="float">State</label>
                </div>
                <div class="form-floating col">
                    <select id="CityId" name="CityId" class="form-control" asp-items="ViewBag.Cities"></select>
                    <label for="CityId" class="float">City</label>
                </div>
            </div>
        </div>

        <br>

        <div class="col-xl-12">
            <div class="row">
                <div class="form-floating col-xl-9 col-sm-8 col-7">
                    <input type="text" class="form-control twoc" id="Address" asp-for="Address">
                    <label for="Address" class="float">Address</label>
                </div>
                <div class="form-floating col">
                    <input type="text" class="form-control twoc" id="Zipcode" asp-for="Zipcode">
                    <label for="Zipcode" class="float">ZipCode</label>
                </div>
            </div>
        </div>

        <div class="form-group forget-remember form-chec p-3 d-flex justify-content-end">
            <button type="submit" class="btn btn-primary m-1"
                style="background-color: #0066A7; color: white; border: 1px solid #0066A7;">Update</button>
            <button asp-controller="Home" asp-action="AdminDashboard" class="btn btn-primary m-1"
                style="background-color: white; color: #0066A7; border: 1px solid #0066A7;">Cancel</button>
        </div>
    </form>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
    $("#CountryId").change(function () {
        var countryId = $(this).val();
        console.log("Selected Country ID:", countryId);

        if (countryId) {
            $.ajax({
                url: '/User/GetStates',
                type: 'GET',
                data: { countryId: countryId },
                dataType: 'json',
                success: function (states) {
                    console.log("Fetched States:", states);
                    var stateDropdown = $("#StateId");
                    stateDropdown.empty().append('<option value="">Select State</option>');
                    $.each(states, function (index, state) {
                        stateDropdown.append('<option value="' + state.id + '">' + state.name + '</option>');
                    });

                    $("#CityId").empty().append('<option value="">Select City</option>'); 
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching states:", xhr.responseText);
                }
            });
        }
    });

    $("#StateId").change(function () {
        var stateId = $(this).val();
        console.log("Selected State ID:", stateId);

        if (stateId) {
            $.ajax({
                url: '/User/GetCities',
                type: 'GET',
                data: { stateId: stateId },
                dataType: 'json',
                success: function (cities) {
                    console.log("Fetched Cities:", cities);
                    var cityDropdown = $("#CityId");
                    cityDropdown.empty().append('<option value="">Select City</option>');
                    $.each(cities, function (index, city) {
                        cityDropdown.append('<option value="' + city.id + '">' + city.name + '</option>');
                    });
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching cities:", xhr.responseText);
                }
            });
        }
    });
});
    </script>
}