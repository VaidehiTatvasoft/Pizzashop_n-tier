@model IEnumerable<Entity.Data.TaxesAndFee>

<div class="table-responsive">
    <table class="table" id="tbl">
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>IsEnabled</th>
                <th>Default</th>
                <th>TaxValue</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var tax in Model)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => tax.Name)</td>
                    <td>
                        @if (tax.Type == true)
                        {
                            <p style="margin: 0;">Percentage</p>
                        }
                        else
                        {
                            <p style="margin: 0;">Flat Amount</p>
                        }
                    </td>
                    <td>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked"
                                   @(tax.IsActive == true ? "checked" : "")>
                        </div>
                    </td>
                    <td>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked"
                                   @(tax.IsDefault == true ? "checked" : "")>
                        </div>
                    </td>
                    <td>
                        @if (tax.Type == true)
                        {
                            @Html.DisplayFor(modelItem => tax.TaxValue)
                            <span>%</span>
                        }
                        else
                        {
                            <span>â‚¹</span>
                            @Html.DisplayFor(modelItem => tax.TaxValue)
                        }
                    </td>
                    <td>
                        <a href="javascript:void(0);" style="text-decoration: none; color: inherit;"
                           class="delete-btn edit-tax" data-id="@tax.Id">
                            <i class="fa-solid fa-pencil m-1"></i>
                        </a>
                        <a href="javascript:void(0)" onclick="confirmDelete(@tax.Id)"
                           style="text-decoration: none; color: inherit;">
                            <i class="fa-solid fa-trash m-1"></i>
                        </a>
                        <form id="deleteform-@tax.Id" method="post"
                              action="@Url.Action("Delete", "Tax", new { id = @tax.Id })" style="display:none;">
                            @Html.AntiForgeryToken()
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>



    <script>
        $(document).ready(function () {
            
            $(document).on('change', '.form-check-input', function () {
                var checkbox = $(this);
                var taxId = checkbox.closest('tr').find('.edit-tax').data('id');
                var isActive = checkbox.is(':checked');
                var isDefault = checkbox.closest('td').next().find('.form-check-input').is(':checked') || false;

                $.ajax({
                    type: "POST",
                    url: "/tax/updateStatus",
                    data: {
                        id: taxId,
                        isActive: isActive,
                        isDefault: isDefault
                    },
                    success: function (response) {
                        if (response.success) {
                            toastr.success(response.message);
                        } else {
                            toastr.error(response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        toastr.error("Failed to update status.");
                        console.error("Error details:", status, error, xhr.responseText);
                    }
                });
            });

            
        });
    </script>
